const EventEmitter=require("events").EventEmitter,spawn=require("child_process").spawn,path=require("path"),fs=require("fs");class Option{constructor(a,b){this.flags=a,this.required=0<=a.indexOf("<"),this.optional=0<=a.indexOf("["),this.mandatory=!1,this.negate=-1!==a.indexOf("-no-");const c=a.split(/[ ,|]+/);1<c.length&&!/^[[<]/.test(c[1])&&(this.short=c.shift()),this.long=c.shift(),this.description=b||"",this.defaultValue=void 0}name(){return this.long.replace(/^--/,"")}attributeName(){return camelcase(this.name().replace(/^no-/,""))}is(a){return this.short===a||this.long===a}}class CommanderError extends Error{constructor(a,b,c){super(c),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=b,this.exitCode=a,this.nestedError=void 0}}class Command extends EventEmitter{constructor(a){super(),this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._args=[],this.rawArgs=null,this._scriptPath=null,this._name=a||"",this._optionValues={},this._storeOptionsAsProperties=!0,this._passCommandToAction=!0,this._actionResults=[],this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._hidden=!1,this._helpFlags="-h, --help",this._helpDescription="display help for command",this._helpShortFlag="-h",this._helpLongFlag="--help",this._hasImplicitHelpCommand=void 0,this._helpCommandName="help",this._helpCommandnameAndArgs="help [command]",this._helpCommandDescription="display help for command"}command(a,b,c){let d=b,e=c;"object"==typeof d&&null!==d&&(e=d,d=null),e=e||{};const f=a.split(/ +/),g=this.createCommand(f.shift());return d&&(g.description(d),g._executableHandler=!0),e.isDefault&&(this._defaultCommandName=g._name),g._hidden=!!(e.noHelp||e.hidden),g._helpFlags=this._helpFlags,g._helpDescription=this._helpDescription,g._helpShortFlag=this._helpShortFlag,g._helpLongFlag=this._helpLongFlag,g._helpCommandName=this._helpCommandName,g._helpCommandnameAndArgs=this._helpCommandnameAndArgs,g._helpCommandDescription=this._helpCommandDescription,g._exitCallback=this._exitCallback,g._storeOptionsAsProperties=this._storeOptionsAsProperties,g._passCommandToAction=this._passCommandToAction,g._executableFile=e.executableFile||null,this.commands.push(g),g._parseExpectedArgs(f),g.parent=this,d?this:g}createCommand(a){return new Command(a)}addCommand(a,b){function c(a){a.forEach(a=>{if(a._executableHandler&&!a._executableFile)throw new Error(`Must specify executableFile for deeply nested executable: ${a.name()}`);c(a.commands)})}if(!a._name)throw new Error("Command passed to .addCommand() must have a name");return c(a.commands),b=b||{},b.isDefault&&(this._defaultCommandName=a._name),(b.noHelp||b.hidden)&&(a._hidden=!0),this.commands.push(a),a.parent=this,this}arguments(a){return this._parseExpectedArgs(a.split(/ +/))}addHelpCommand(a,b){return!1===a?this._hasImplicitHelpCommand=!1:(this._hasImplicitHelpCommand=!0,"string"==typeof a&&(this._helpCommandName=a.split(" ")[0],this._helpCommandnameAndArgs=a),this._helpCommandDescription=b||this._helpCommandDescription),this}_lazyHasImplicitHelpCommand(){return void 0===this._hasImplicitHelpCommand&&(this._hasImplicitHelpCommand=this.commands.length&&!this._actionHandler&&!this._findCommand("help")),this._hasImplicitHelpCommand}_parseExpectedArgs(a){if(a.length)return a.forEach(a=>{const b={required:!1,name:"",variadic:!1};switch(a[0]){case"<":b.required=!0,b.name=a.slice(1,-1);break;case"[":b.name=a.slice(1,-1);}3<b.name.length&&"..."===b.name.slice(-3)&&(b.variadic=!0,b.name=b.name.slice(0,-3)),b.name&&this._args.push(b)}),this._args.forEach((a,b)=>{if(a.variadic&&b<this._args.length-1)throw new Error(`only the last argument can be variadic '${a.name}'`)}),this}exitOverride(a){return this._exitCallback=a?a:a=>{if("commander.executeSubCommandAsync"!==a.code)throw a;else;},this}_exit(a,b,c){this._exitCallback&&this._exitCallback(new CommanderError(a,b,c)),process.exit(a)}action(a){return this._actionHandler=b=>{const c=this._args.length,d=b.slice(0,c);d[c]=this._passCommandToAction?this:this.opts(),b.length>c&&d.push(b.slice(c));const e=a.apply(this,d);let f=this;for(;f.parent;)f=f.parent;f._actionResults.push(e)},this}_optionEx(a,b,c,d,e){const f=new Option(b,c),g=f.name(),h=f.attributeName();if(f.mandatory=!!a.mandatory,"function"!=typeof d)if(d instanceof RegExp){const a=d;d=(b,c)=>{const d=a.exec(b);return d?d[0]:c}}else e=d,d=null;if(f.negate||f.optional||f.required||"boolean"==typeof e){if(f.negate){const a=f.long.replace(/^--no-/,"--");e=!this._findOption(a)||this._getOptionValue(h)}void 0!==e&&(this._setOptionValue(h,e),f.defaultValue=e)}return this.options.push(f),this.on("option:"+g,a=>{null!==a&&d&&(a=d(a,void 0===this._getOptionValue(h)?e:this._getOptionValue(h))),"boolean"==typeof this._getOptionValue(h)||"undefined"==typeof this._getOptionValue(h)?null==a?this._setOptionValue(h,!f.negate&&(e||!0)):this._setOptionValue(h,a):null!==a&&this._setOptionValue(h,!f.negate&&a)}),this}option(a,b,c,d){return this._optionEx({},a,b,c,d)}requiredOption(a,b,c,d){return this._optionEx({mandatory:!0},a,b,c,d)}allowUnknownOption(a){return this._allowUnknownOption=void 0===a||a,this}storeOptionsAsProperties(a){if(this._storeOptionsAsProperties=void 0===a||a,this.options.length)throw new Error("call .storeOptionsAsProperties() before adding options");return this}passCommandToAction(a){return this._passCommandToAction=void 0===a||a,this}_setOptionValue(a,b){this._storeOptionsAsProperties?this[a]=b:this._optionValues[a]=b}_getOptionValue(a){return this._storeOptionsAsProperties?this[a]:this._optionValues[a]}parse(a,b){if(void 0!==a&&!Array.isArray(a))throw new Error("first parameter to parse must be array or undefined");b=b||{},void 0===a&&(a=process.argv,process.versions&&process.versions.electron&&(b.from="electron")),this.rawArgs=a.slice();let c;switch(b.from){case void 0:case"node":this._scriptPath=a[1],c=a.slice(2);break;case"electron":process.defaultApp?(this._scriptPath=a[1],c=a.slice(2)):c=a.slice(1);break;case"user":c=a.slice(0);break;default:throw new Error(`unexpected parse option { from: '${b.from}' }`);}return!this._scriptPath&&process.mainModule&&(this._scriptPath=process.mainModule.filename),this._name=this._name||this._scriptPath&&path.basename(this._scriptPath,path.extname(this._scriptPath)),this._parseCommand([],c),this}parseAsync(a,b){return this.parse(a,b),Promise.all(this._actionResults).then(()=>this)}_executeSubCommand(a,b){b=b.slice();let c=!1;const d=[".js",".ts",".mjs"];this._checkForMissingMandatoryOptions();const e=this._scriptPath;let f;try{const a=fs.realpathSync(e);f=path.dirname(a)}catch(a){f="."}let g=path.basename(e,path.extname(e))+"-"+a._name;a._executableFile&&(g=a._executableFile);const h=path.join(f,g);fs.existsSync(h)?g=h:d.forEach(a=>{fs.existsSync(`${h}${a}`)&&(g=`${h}${a}`)}),c=d.includes(path.extname(g));let i;"win32"===process.platform?(b.unshift(g),b=incrementNodeInspectorPort(process.execArgv).concat(b),i=spawn(process.execPath,b,{stdio:"inherit"})):c?(b.unshift(g),b=incrementNodeInspectorPort(process.execArgv).concat(b),i=spawn(process.argv[0],b,{stdio:"inherit"})):i=spawn(g,b,{stdio:"inherit"});["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach(a=>{process.on(a,()=>{!1===i.killed&&null===i.exitCode&&i.kill(a)})});const j=this._exitCallback;j?i.on("close",()=>{j(new CommanderError(process.exitCode||0,"commander.executeSubCommandAsync","(close)"))}):i.on("close",process.exit.bind(process)),i.on("error",b=>{if("ENOENT"===b.code){const b=`'${g}' does not exist
 - if '${a._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name`;throw new Error(b)}else if("EACCES"===b.code)throw new Error(`'${g}' not executable`);if(!j)process.exit(1);else{const a=new CommanderError(1,"commander.executeSubCommandAsync","(error)");a.nestedError=b,j(a)}}),this.runningCommand=i}_dispatchSubcommand(a,b,c){const d=this._findCommand(a);d||this._helpAndError(),d._executableHandler?this._executeSubCommand(d,b.concat(c)):d._parseCommand(b,c)}_parseCommand(a,b){const c=this.parseOptions(b);if(a=a.concat(c.operands),b=c.unknown,this.args=a.concat(b),a&&this._findCommand(a[0]))this._dispatchSubcommand(a[0],a.slice(1),b);else if(this._lazyHasImplicitHelpCommand()&&a[0]===this._helpCommandName)1===a.length?this.help():this._dispatchSubcommand(a[1],[],[this._helpLongFlag]);else if(this._defaultCommandName)outputHelpIfRequested(this,b),this._dispatchSubcommand(this._defaultCommandName,a,b);else if(!this.commands.length||0!==this.args.length||this._actionHandler||this._defaultCommandName||this._helpAndError(),outputHelpIfRequested(this,c.unknown),this._checkForMissingMandatoryOptions(),0<c.unknown.length&&this.unknownOption(c.unknown[0]),this._actionHandler){const c=this.args.slice();this._args.forEach((a,b)=>{a.required&&null==c[b]?this.missingArgument(a.name):a.variadic&&(c[b]=c.splice(b))}),this._actionHandler(c),this.emit("command:"+this.name(),a,b)}else if(a.length)this._findCommand("*")?this._dispatchSubcommand("*",a,b):this.listenerCount("command:*")?this.emit("command:*",a,b):this.commands.length&&this.unknownCommand();else if(this.commands.length)this._helpAndError();else;}_findCommand(a){return a?this.commands.find(b=>b._name===a||b._aliases.includes(a)):void 0}_findOption(a){return this.options.find(b=>b.is(a))}_checkForMissingMandatoryOptions(){for(let a=this;a;a=a.parent)a.options.forEach(b=>{b.mandatory&&a._getOptionValue(b.attributeName())===void 0&&a.missingMandatoryOptionValue(b)})}parseOptions(a){function b(a){return 1<a.length&&"-"===a[0]}const c=[],d=[];let e=c;for(const c=a.slice();c.length;){const a=c.shift();if("--"===a){e===d&&e.push(a),e.push(...c);break}if(b(a)){const d=this._findOption(a);if(d){if(d.required){const a=c.shift();void 0===a&&this.optionMissingArgument(d),this.emit(`option:${d.name()}`,a)}else if(d.optional){let a=null;0<c.length&&!b(c[0])&&(a=c.shift()),this.emit(`option:${d.name()}`,a)}else this.emit(`option:${d.name()}`);continue}}if(2<a.length&&"-"===a[0]&&"-"!==a[1]){const b=this._findOption(`-${a[1]}`);if(b){b.required||b.optional?this.emit(`option:${b.name()}`,a.slice(2)):(this.emit(`option:${b.name()}`),c.unshift(`-${a.slice(2)}`));continue}}if(/^--[^=]+=/.test(a)){const b=a.indexOf("="),c=this._findOption(a.slice(0,b));if(c&&(c.required||c.optional)){this.emit(`option:${c.name()}`,a.slice(b+1));continue}}1<a.length&&"-"===a[0]&&(e=d),e.push(a)}return{operands:c,unknown:d}}opts(){if(this._storeOptionsAsProperties){const a={},b=this.options.length;for(let c=0;c<b;c++){const b=this.options[c].attributeName();a[b]=b===this._versionOptionName?this._version:this[b]}return a}return this._optionValues}missingArgument(a){const b=`error: missing required argument '${a}'`;console.error(b),this._exit(1,"commander.missingArgument",b)}optionMissingArgument(a,b){let c;c=b?`error: option '${a.flags}' argument missing, got '${b}'`:`error: option '${a.flags}' argument missing`,console.error(c),this._exit(1,"commander.optionMissingArgument",c)}missingMandatoryOptionValue(a){const b=`error: required option '${a.flags}' not specified`;console.error(b),this._exit(1,"commander.missingMandatoryOptionValue",b)}unknownOption(a){if(!this._allowUnknownOption){const b=`error: unknown option '${a}'`;console.error(b),this._exit(1,"commander.unknownOption",b)}}unknownCommand(){const a=[this.name()];for(let b=this.parent;b;b=b.parent)a.unshift(b.name());const b=a.join(" "),c=`error: unknown command '${this.args[0]}'. See '${b} ${this._helpLongFlag}'.`;console.error(c),this._exit(1,"commander.unknownCommand",c)}version(a,b,c){if(void 0===a)return this._version;this._version=a,b=b||"-V, --version",c=c||"output the version number";const d=new Option(b,c);return this._versionOptionName=d.long.substr(2)||"version",this.options.push(d),this.on("option:"+this._versionOptionName,()=>{process.stdout.write(a+"\n"),this._exit(0,"commander.version",a)}),this}description(a,b){return void 0===a&&void 0===b?this._description:(this._description=a,this._argsDescription=b,this)}alias(a){if(void 0===a)return this._aliases[0];let b=this;if(0!==this.commands.length&&this.commands[this.commands.length-1]._executableHandler&&(b=this.commands[this.commands.length-1]),a===b._name)throw new Error("Command alias can't be the same as its name");return b._aliases.push(a),this}aliases(a){return void 0===a?this._aliases:(a.forEach(a=>this.alias(a)),this)}usage(a){if(void 0===a){if(this._usage)return this._usage;const a=this._args.map(a=>humanReadableArgName(a));return"[options]"+(this.commands.length?" [command]":"")+(this._args.length?" "+a.join(" "):"")}return this._usage=a,this}name(a){return void 0===a?this._name:(this._name=a,this)}prepareCommands(){const a=this.commands.filter(a=>!a._hidden).map(a=>{const b=a._args.map(a=>humanReadableArgName(a)).join(" ");return[a._name+(a._aliases[0]?"|"+a._aliases[0]:"")+(a.options.length?" [options]":"")+(b?" "+b:""),a._description]});return this._lazyHasImplicitHelpCommand()&&a.push([this._helpCommandnameAndArgs,this._helpCommandDescription]),a}largestCommandLength(){const a=this.prepareCommands();return a.reduce((a,b)=>Math.max(a,b[0].length),0)}largestOptionLength(){const a=[].slice.call(this.options);return a.push({flags:this._helpFlags}),a.reduce((a,b)=>Math.max(a,b.flags.length),0)}largestArgLength(){return this._args.reduce((a,b)=>Math.max(a,b.name.length),0)}padWidth(){let a=this.largestOptionLength();return this._argsDescription&&this._args.length&&this.largestArgLength()>a&&(a=this.largestArgLength()),this.commands&&this.commands.length&&this.largestCommandLength()>a&&(a=this.largestCommandLength()),a}optionHelp(){function a(a,c){return pad(a,b)+"  "+optionalWrap(c,d,b+2)}const b=this.padWidth(),c=process.stdout.columns||80,d=c-b-4;const e=this.options.map(b=>{const c=b.description+(b.negate||b.defaultValue===void 0?"":" (default: "+JSON.stringify(b.defaultValue)+")");return a(b.flags,c)}),f=this._helpShortFlag&&!this._findOption(this._helpShortFlag),g=!this._findOption(this._helpLongFlag);if(f||g){let b=this._helpFlags;f?!g&&(b=this._helpShortFlag):b=this._helpLongFlag,e.push(a(b,this._helpDescription))}return e.join("\n")}commandHelp(){if(!this.commands.length&&!this._lazyHasImplicitHelpCommand())return"";const a=this.prepareCommands(),b=this.padWidth(),c=process.stdout.columns||80;return["Commands:",a.map(a=>{const d=a[1]?"  "+a[1]:"";return(d?pad(a[0],b):a[0])+optionalWrap(d,c-b-4,b+2)}).join("\n").replace(/^/gm,"  "),""].join("\n")}helpInformation(){let a=[];if(this._description){a=[this._description,""];const b=this._argsDescription;if(b&&this._args.length){const c=this.padWidth(),d=process.stdout.columns||80;a.push("Arguments:"),a.push(""),this._args.forEach(e=>{a.push("  "+pad(e.name,c)+"  "+wrap(b[e.name],d-c-5,c+4))}),a.push("")}}let b=this._name;this._aliases[0]&&(b=b+"|"+this._aliases[0]);let c="";for(let a=this.parent;a;a=a.parent)c=a.name()+" "+c;const d=["Usage: "+c+b+" "+this.usage(),""];let e=[];const f=this.commandHelp();f&&(e=[f]);const g=["Options:",""+this.optionHelp().replace(/^/gm,"  "),""];return d.concat(a).concat(g).concat(e).join("\n")}outputHelp(a){a||(a=a=>a);const b=a(this.helpInformation());if("string"!=typeof b&&!Buffer.isBuffer(b))throw new Error("outputHelp callback must return a string or a Buffer");process.stdout.write(b),this.emit(this._helpLongFlag)}helpOption(a,b){this._helpFlags=a||this._helpFlags,this._helpDescription=b||this._helpDescription;const c=this._helpFlags.split(/[ ,|]+/);return this._helpShortFlag=void 0,1<c.length&&(this._helpShortFlag=c.shift()),this._helpLongFlag=c.shift(),this}help(a){this.outputHelp(a),this._exit(process.exitCode||0,"commander.help","(outputHelp)")}_helpAndError(){this.outputHelp(),this._exit(1,"commander.help","(outputHelp)")}}exports=module.exports=new Command,exports.program=exports,exports.Command=Command,exports.Option=Option,exports.CommanderError=CommanderError;function camelcase(a){return a.split("-").reduce((a,b)=>a+b[0].toUpperCase()+b.slice(1))}function pad(a,b){const c=Math.max(0,b-a.length);return a+Array(c+1).join(" ")}function wrap(a,b,c){const d=new RegExp(".{1,"+(b-1)+"}([\\s\u200B]|$)|[^\\s\u200B]+?([\\s\u200B]|$)","g"),e=a.match(d)||[];return e.map((a,b)=>("\n"===a.slice(-1)&&(a=a.slice(0,a.length-1)),(0<b&&c?Array(c+1).join(" "):"")+a.trimRight())).join("\n")}function optionalWrap(a,b,c){if(a.match(/[\n]\s+/))return a;return 40>b?a:wrap(a,b,c)}function outputHelpIfRequested(a,b){const c=b.find(b=>b===a._helpLongFlag||b===a._helpShortFlag);c&&(a.outputHelp(),a._exit(0,"commander.helpDisplayed","(outputHelp)"))}function humanReadableArgName(a){const b=a.name+(!0===a.variadic?"...":"");return a.required?"<"+b+">":"["+b+"]"}function incrementNodeInspectorPort(a){return a.map(a=>{let b=a;if(0===a.indexOf("--inspect")){let c,d,e="127.0.0.1",f="9229";null===(d=a.match(/^(--inspect(-brk)?)$/))?null===(d=a.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))?null!==(d=a.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))&&(c=d[1],e=d[3],f=d[4]):(c=d[1],/^\d+$/.test(d[3])?f=d[3]:e=d[3]):c=d[1],c&&"0"!==f&&(b=`${c}=${e}:${parseInt(f)+1}`)}return b})}
